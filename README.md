# Deploy kit 

tags： tool

---
DeployKit，一个部署工具,可执行程序`dk.exe`。在实际应用上线是再平常不过的事了，目前的一些平台工具可以覆盖大部分的上线工作，可是还是有一丢丢需要手动操作，这里就是来解决这部分问题的。

## 起步
这些任务概括起来是把一个包部署到一组服务器，然后执行一些脚本，具体过程类似：1.上传，2 解压。文件包最可能在的几个地方：

1. 本地磁盘。需要上传服务器.并执行相应命令。
2. 公网地址。生产服务器可以访问，直接在服务器上 `wget`就可以获得。
3. 内网地址。生产服务器不能访问，需要先下载到本地磁盘再上传到服务器。

工具使用命令风格，没有界面。编译结果为可执行文件`dk.exe` 其参数用法如下:

```sh
Usage of dk.exe:
  -lurl string
        内网仓库地址.服务器不能直接访问,需要先下载到本地磁盘再上传服务器. e.g. http://127.0.0.1/a.zip.
  -name string
        项目名称，对应配置文件名. e.g. ec 代表使用配置文件ec.json.无效时报错。
  -path string
        本地磁盘路径，直接上传服务器. e.g. /tmp/a.zip.
  -url string
        外网仓库地址.可以直接在服务器上 wget. e.g. http://test.com/a.zip.
  -v string
        版本，是zip文件名的一部分. e.g. v1.0.0.

注意: url,path,和lurl三个参数互斥,按照上述顺序检查到一个有效值时停止,否则报错.
```
> 执行命令 `./dk.exe -h` 可以看到上述描述。

配置文件和dk.exe 同目录，名称自定义，结构如下：

```json
{
  "Name":"project",
  "Servers": [
    {
      "Ip": "172.1.1.1",
      "Port": 22,
      "Username": "root",
      "Password": "xxxxx",
      "WorkDir": "/tmp"
    },
    {
      "Ip": "172.1.1.2",
      "Port": 22,
      "Username": "root",
      "Password": "xxxxx",
      "WorkDir": "/tmp"
    }
  ]
}
```
其中name是项目名称，Servers是要部署的服务器列表。假如要把本地磁盘"./upload"目录下`testv1.0.0.zip`部署到配置文件描述的环境中应该是:

```sh
dk.exe -name=test -v=v1.0.0 -path="./upload/"
```

## 最佳实践
通常项目的名称和包路径以及路径形式（url，path,lurl）都是不变的，经常变化的只有版本。所以应该写一个脚本代替命令，并把版本定义成一个变量，每次部署新版本时编辑该变量然后执行脚本。

还有更好的办法是让这个脚本可以接受一个参数作为版本，使用起来就像是：
```sh
deploy.sh v1.0.0
```

以上。
